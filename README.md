# 数据集格式转换：Labelme - PascalVOC - MS COCO

## 标注工具和两个数据集标注格式

labelme是常用的数据标注工具，详见：[labelme: Image Polygonal Annotation with Python](https://github.com/wkentaro/labelme)

PASCAL VOC和 MS COCO是两个公开的大型数据集，开源的目标检测算法大都支持这两种数据集的标注格式。
两个数据集及标注格式的介绍：

[目标检测数据集PASCAL VOC简介](https://arleyzhang.github.io/articles/1dc20586/)

[目标检测数据集MSCOCO简介](https://arleyzhang.github.io/articles/e5b86f16/)


## Code

- json_to_dataset.py: 演示如何将一份labelme标注的json文件转换为图像数据集，仅供参考。
- label_names.txt：标注时的目标分类名字。按照格式准备好，转换时需要用到。
- 瑕疵中英文名.txt：检测目标中英文名对照，修改此处以针对由中文分类标注到英文分类标注转换的需求。（数据集中统一用英文表示）
- buildNameDict.py：根据中英文对照表，生成互相转换的词典。
- labelme2voc.py：将labelme标注的json批量转换为voc格式数据集。
- datasetsSplit.py：将voc形式的数据集划分为训练集和测试集。划分方案可以自己修改。
- convertVOC2COCO：将voc形式的数据集根据训练测试划分，生成coco形式的json文件。

## Required package

Refer: [Anaconda style](https://github.com/wkentaro/labelme#anaconda) :
```bash
# python3
conda create --name=labelme python=3.6
source activate labelme
# conda install -c conda-forge pyside2
# conda install pyqt
pip install pyqt5  # pyqt5 can be installed via pip on python3
pip install labelme

conda install scikit-learn  # for train and test split
pip install xmltodict
```

## Usage

### step1: prepare label_names.txt and cn-to-en.txt(e.g. 瑕疵中英文名.txt)

根据数据集，建立label_names.txt和cn-to-en.txt（第一列中文，第二列英文）。如果标注时就已经用了英文，则（第一列英文，第二列也英文即可）。

### step2：convert labelme jsons to voc style datasets

`python labelme2voc.py label_names.txt labelme_jsonfiles_dir outputVOCdir`

- label_names.txt: 包含所有分类名的文本
- labelme_jsonfiles_dir: labelme生成的json所在文件夹
- outputVOCdir：VOC格式数据集文件夹用以接收输出

**注意:** 运行前确认代码中的几处细节
- 修改正则表达式规则，用于从json文件名中获取图像和标注文件名。
- 修改中英文对照的文本文件

### step3: convert voc style datasets to coco style datasets

#### 3.1 split datasets to train and test
change `datasetsSplit.py` file：
- annotationXmlDir
- outputDir
- change split ratio in `train_test_split` function

then, run `datasetsSplit.py` file, get train.txt and test.txt at outputDir.
these two files contains the filenames for train datasets and test datasets.

#### 3.2 convert voc xmls to coco style jso
change these variables in `convertVOC2COCO.py` :
- `attrDict`: classes and it's NO. 
- `File`：path to `train.txt` or `test.txt`, which generated before.
- `rootDir`: path to directory that contains VOC style annotation files.
- `jsonFile`: coco style json file generated by this program.

then, run `convertVOC2COCO.py` , change `File` to train.txt and test.txt to get train.json and test.json, respectively.

 